"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["login-form.plugin"],{545:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});var r=s(266);class o{static serialize(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==e.nodeName){if(t)throw Error("The passed element is not a form!");return{}}return new FormData(e)}static serializeJson(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=o.serialize(e,t);if(0===Object.keys(s).length)return{};let i={};return r.Z.iterate(s,(e,t)=>i[t]=e),i}}var i=s(709),n=s(107);class a extends window.PluginBaseClass{init(){if(this._forms=i.Z.querySelectorAll(this.el,"form"),this._forms.length<1)throw Error("No form found for the plugin: ".concat(this.constructor.name));this._opener=i.Z.querySelector(document.body,this.options.opener),this._closer=i.Z.querySelector(this.el,this.options.closer),this._opener&&this._closer&&(this._client=new n.Z,this._registerEvents())}_registerEvents(){let e=i.Z.querySelectorAll(this.el,this.options.submitSelector);r.Z.iterate(e,e=>{e.addEventListener("click",e=>this._onSubmitForm(e))});let t=i.Z.querySelectorAll(this.el,".is-toggle");r.Z.iterate(t,e=>{e.addEventListener("click",e=>{this._onToggleForm(e)})}),this._opener.addEventListener("click",e=>{this._onOpenModal(e)}),this._closer.addEventListener("click",e=>{this._onOpenModal(e)})}_onOpenModal(e){e.preventDefault(),this.el.classList.contains(this.options.openClass)?(this.el.classList.remove(this.options.openClass),this.el.classList.remove(this.options.errorClass),this.el.classList.remove(this.options.successClass),r.Z.iterate(this._forms,(e,t)=>{0==t?e.classList.remove("is-hide"):e.classList.add("is-hide")})):this.el.classList.add(this.options.openClass)}_onSubmitForm(e){e.preventDefault();let t=e.currentTarget.closest("form");if(!1===t.checkValidity())return;this.el.classList.remove(this.options.errorClass),this.el.classList.add(this.options.progressClass);let s=new FormData,r=o.serialize(t);"login"==i.Z.getAttribute(t,"name")&&(s.append("username",r.get(this.options.login)),s.append("password",r.get(this.options.password)),this._client.post("/ssik/login",s,this._handleData.bind(this,t))),"restore"==i.Z.getAttribute(t,"name")&&(s.append("email[email]",r.get("ssikRestoreUsername")),this._client.post("/ssik/recovery",s,this._handleData.bind(this,t)))}_handleData(e,t){let s=JSON.parse(t);this.el.classList.remove(this.options.progressClass),"login"==i.Z.getAttribute(e,"name")&&(s.errors?this.el.classList.add(this.options.errorClass):(this.el.classList.add(this.options.successClass),setTimeout(()=>{this.options.storefrontUrl?document.location.href="".concat(this.options.storefrontUrl,"/account"):document.location.reload()},100))),"restore"==i.Z.getAttribute(e,"name")&&this.el.classList.add(this.options.successClass)}_onToggleForm(e){e.preventDefault(),this.el.classList.remove(this.options.errorClass),this.el.classList.remove(this.options.successClass),r.Z.iterate(this._forms,e=>{e.classList.toggle("is-hide")})}}a.options={opener:".product-box",closer:".login-modal-close",login:"ssikUsername",password:"ssikPassword",submitSelector:".login-modal-form-submit",errorOutputSelector:".login-modal-errors",openClass:"is-opened",progressClass:"is-progress",errorClass:"is-error",successClass:"is-success",storefrontUrl:null}},709:(e,t,s)=>{s.d(t,{Z:()=>o});class r{static ucFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}static lcFirst(e){return e.charAt(0).toLowerCase()+e.slice(1)}static toDashCase(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(e,t){let s=r.toUpperCamelCase(e,t);return r.lcFirst(s)}static toUpperCamelCase(e,t){return t?e.split(t).map(e=>r.ucFirst(e.toLowerCase())).join(""):r.ucFirst(e.toLowerCase())}static parsePrimitive(e){try{return/^\d+(.|,)\d+$/.test(e)&&(e=e.replace(",",".")),JSON.parse(e)}catch(t){return e.toString()}}}class o{static isNode(e){return"object"==typeof e&&null!==e&&(e===document||e===window||e instanceof Node)}static hasAttribute(e,t){if(!o.isNode(e))throw Error("The element must be a valid HTML Node!");return"function"==typeof e.hasAttribute&&e.hasAttribute(t)}static getAttribute(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(s&&!1===o.hasAttribute(e,t))throw Error('The required property "'.concat(t,'" does not exist!'));if("function"!=typeof e.getAttribute){if(s)throw Error("This node doesn't support the getAttribute function!");return}return e.getAttribute(t)}static getDataAttribute(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=t.replace(/^data(|-)/,""),n=r.toLowerCamelCase(i,"-");if(!o.isNode(e)){if(s)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===e.dataset){if(s)throw Error("This node doesn't support the dataset attribute!");return}let a=e.dataset[n];if(void 0===a){if(s)throw Error('The required data attribute "'.concat(t,'" does not exist on ').concat(e,"!"));return a}return r.parsePrimitive(a)}static querySelector(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(s&&!o.isNode(e))throw Error("The parent node is not a valid HTML Node!");let r=e.querySelector(t)||!1;if(s&&!1===r)throw Error('The required element "'.concat(t,'" does not exist in parent node!'));return r}static querySelectorAll(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(s&&!o.isNode(e))throw Error("The parent node is not a valid HTML Node!");let r=e.querySelectorAll(t);if(0===r.length&&(r=!1),s&&!1===r)throw Error('At least one item of "'.concat(t,'" must exist in parent node!'));return r}static getFocusableElements(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return e.querySelectorAll('\n            input:not([tabindex^="-"]):not([disabled]):not([type="hidden"]),\n            select:not([tabindex^="-"]):not([disabled]),\n            textarea:not([tabindex^="-"]):not([disabled]),\n            button:not([tabindex^="-"]):not([disabled]),\n            a[href]:not([tabindex^="-"]):not([disabled]),\n            [tabindex]:not([tabindex^="-"]):not([disabled])\n        ')}static getFirstFocusableElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return this.getFocusableElements(e)[0]}static getLastFocusableElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=this.getFocusableElements(e);return t[t.length-1]}}},266:(e,t,s)=>{s.d(t,{Z:()=>r});class r{static iterate(e,t){if(e instanceof Map||Array.isArray(e))return e.forEach(t);if(e instanceof FormData){for(var s of e.entries())t(s[1],s[0]);return}if(e instanceof NodeList)return e.forEach(t);if(e instanceof HTMLCollection)return Array.from(e).forEach(t);if(e instanceof Object)return Object.keys(e).forEach(s=>{t(e[s],s)});throw Error("The element type ".concat(typeof e," is not iterable!"))}}},107:(e,t,s)=>{s.d(t,{Z:()=>r});class r{get(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",r=this._createPreparedRequest("GET",e,s);return this._sendRequest(r,null,t)}post(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let o=this._createPreparedRequest("POST",e,r);return this._sendRequest(o,t,s)}delete(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let o=this._createPreparedRequest("DELETE",e,r);return this._sendRequest(o,t,s)}patch(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let o=this._createPreparedRequest("PATCH",e,r);return this._sendRequest(o,t,s)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(e){this._errorHandlingInternal=e}_registerOnLoaded(e,t){t&&(!0===this._errorHandlingInternal?(e.addEventListener("load",()=>{t(e.responseText,e)}),e.addEventListener("abort",()=>{console.warn("the request to ".concat(e.responseURL," was aborted"))}),e.addEventListener("error",()=>{console.warn("the request to ".concat(e.responseURL," failed with status ").concat(e.status))}),e.addEventListener("timeout",()=>{console.warn("the request to ".concat(e.responseURL," timed out"))})):e.addEventListener("loadend",()=>{t(e.responseText,e)}))}_sendRequest(e,t,s){return this._registerOnLoaded(e,s),e.send(t),e}_getContentType(e,t){return e instanceof FormData&&(t=!1),t}_createPreparedRequest(e,t,s){return this._request=new XMLHttpRequest,this._request.open(e,t),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),s&&this._request.setRequestHeader("Content-type",s),this._request}constructor(){this._request=null,this._errorHandlingInternal=!1}}}}]);